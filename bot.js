const Discord = require('discord.js');
const client = new Discord.Client();
const prefix = "+";
const fs = require('fs');
const moment = require('moment');
const convert = require("hh-mm-ss")
var Canvas = require('canvas')
var jimp = require('jimp')




client.on('ready', () => {
    console.log('I am ready!');
});

                                                                                                                                                                 

client.on('ready', () => {                           
client.user.setGame(`_Pros System,`);                                                                                                                                                                                                                                                                                                                                                                                                                            
});





client.on('guildMemberAdd', member =>{
    member.addRole(member.guild.roles.find(x => x.name === 'â“Ÿ[The_Pros]'), "Auto-Role")
});





client.on('guildMemberAdd', member => {
     const welcomer =  member.guild.channels.find('name', 'ðŸ˜Žâ™£â¨â˜žâ€¤welcomeâ€¤â˜œâ©â™£');
    if(!welcomer) return;
      if(welcomer) {
         moment.locale('ar-ly');
         var m = member.user;
        let yumz = new Discord.RichEmbed()
        .setThumbnail(m.avatarURL)
        .setAuthor(m.username,m.avatarURL)
        .addField(': ØªØ§Ø±ÙŠØ® Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„Ø¯Ø³ÙƒÙˆØ±Ø¯',`${moment(member.user.createdAt).format('D/M/YYYY h:mm a')} **\n** \`${moment(member.user.createdAt).fromNow()}\``,true)            
         .setFooter(`${m.tag}`,"https://images-ext-2.discordapp.net/external/JpyzxW2wMRG2874gSTdNTpC_q9AHl8x8V4SMmtRtlVk/https/orcid.org/sites/default/files/files/ID_symbol_B-W_128x128.gif")
     welcomer.send({embed:yumz});          
         
    



const w = ['./welcome.png'];

         let Image = Canvas.Image,
            canvas = new Canvas(400, 200),
            ctx = canvas.getContext('2d');
        fs.readFile(`${w[Math.floor(Math.random() * w.length)]}`, function (err, Background) {
            if (err) return console.log(err);
            let BG = Canvas.Image;
            let ground = new Image;
            ground.src = Background;
            ctx.drawImage(ground, 0, 0, 400, 200);
             
          

                let url = member.user.displayAvatarURL.endsWith(".webp") ? member.user.displayAvatarURL.slice(100) + ".png" : member.user.displayAvatarURL;
                jimp.read(url, (err, ava) => {
                    if (err) return console.log(err);
                    ava.getBuffer(jimp.MIME_PNG, (err, buf) => {
                        if (err) return console.log(err);
                        
                        ctx.font = "bold 12px Arial";
                        ctx.fontSize = '59px';
                        ctx.fillStyle = "#f1f1f1";
                        ctx.textAlign = "center";
                        ctx.fillText(``, 300, 130);
                        
                        ctx.font = "bold 12px Arial";
                        ctx.fontSize = '50px';
                        ctx.fillStyle = "#f1f1f1";
                        ctx.textAlign = "center";
                        ctx.fillText(member.user.username, 200, 150);
 
                let Avatar = Canvas.Image;
                              let ava = new Avatar;
                              ava.src = buf;
                              ctx.beginPath();
                              ctx.arc(77, 101, 62, 0, Math.PI*2);
                              ctx.stroke();
                                 ctx.clip();
                                 ctx.drawImage(ava, 13, 38, 128, 126);  
                          
                
                             
welcomer.sendFile(canvas.toBuffer())



      
      
                    }  )  
      
                    

})
      });                    
 }
});



client.on("message", message => {
    var prefix = "+";
        if (message.author.id === client.user.id) return;
        if (message.guild) {
       let embed = new Discord.RichEmbed()
        let args = message.content.split(' ').slice(1).join(' ');
    if(message.content.split(' ')[0] == prefix + 'bc') {
        if (!args[1]) {
    message.channel.send("**bc <message>**");
    return;
    }
            message.guild.members.forEach(m => {
       if(!message.member.hasPermission('ADMINISTRATOR')) return;
                m.send(args);
            });
            const AziRo = new Discord.RichEmbed()
            .setAuthor(message.author.username, message.author.avatarURL)   
            .setTitle('âœ…| Ø¬Ø§Ø±ÙŠ Ø§Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ ') 
            .addBlankField(true)
            .addField('â™¨| Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø±Ø³Ù„ Ù„Ù‡Ù… ', message.guild.memberCount , true)        
            .addField('ðŸ“| Ø§Ù„Ø±Ø³Ø§Ù„Ø© ', args)
            .setColor('RANDOM')  
            message.channel.sendEmbed(AziRo);          
        }
        } else {
            return;
        }
    });





client.on('message', message => {
if(message.author.bot) return;
              if(!message.channel.guild) return;
    var prefix = "+";
    if(message.content.startsWith(prefix + 'msg')) {
    if(!message.channel.guild) return message.channel.send('**Ø§Ù„Ø£Ù…Ø± Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª Ø¨Ø³**').then(m => m.delete(5000));
  if(!message.member.hasPermission('ADMINISTRATOR')) return      message.channel.send('**Ù…Ø§Ø¹Ù†Ø¯Ùƒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©**' );
    let args = message.content.split(" ").join(" ").slice(2 + prefix.length);
    let copy = "ã€ŽÎ¶ÍœÍ¡M Botã€";
    let request = `Requested By ${message.author.username}`;
    if (!args) return message.reply('**ØªØ±Ø³Ù„ Ø¨Ø±ÙˆØ¯ÙƒØ§Ø³Øª ÙØ§Ø¶ÙŠØŸ**');message.channel.send(`**Ù…ØªØ£ÙƒØ¯ØŸ** \` ${args}\``).then(msg => {
    msg.react('âœ…')
    .then(() => msg.react('âŒ'))
    .then(() =>msg.react('âœ…'))

    let reaction1Filter = (reaction, user) => reaction.emoji.name === 'âœ…' && user.id === message.author.id;
    let reaction2Filter = (reaction, user) => reaction.emoji.name === 'âŒ' && user.id === message.author.id;

    let reaction1 = msg.createReactionCollector(reaction1Filter, { time: 12000 });
    let reaction2 = msg.createReactionCollector(reaction2Filter, { time: 12000 });
    reaction1.on("collect", r => {
    message.channel.send(`**â˜‘ | Done ... The Broadcast Message Has Been Sent For ${message.guild.members.size} Members**`).then(m => m.delete(5000));
    message.guild.members.forEach(m => {
    var bc = new
       Discord.RichEmbed()
       .setColor('#00ff47')
       .setTitle('**:incoming_envelope:Ø±Ø³Ø§Ù„Ø©:incoming_envelope:')
       .addField('**:diamond_shape_with_a_dot_inside:Ø§Ù„Ø³ÙŠØ±ÙØ±:diamond_shape_with_a_dot_inside:**', message.guild.name)
       .addField('**:black_joker:Ø§Ù„Ù…Ø±Ø³Ù„:black_joker:**', message.author.username)
       .addField(':page_facing_up:Ø§Ù„Ø±Ø³Ø§Ù„Ø©:page_facing_up:', args)
       .setThumbnail(message.author.avatarURL)
       .setFooter(copy, client.user.avatarURL);
    m.send({ embed: bc })
    msg.delete();
    })
    })
    reaction2.on("collect", r => {
    message.channel.send(`**ÙƒÙ†Ø³Ù„ ÙŠØ§ Ù…Ø¯ÙŠØ±**`).then(m => m.delete(5000));
    msg.delete();
    })
    })
    }
let cooldown = new Set();
let cdseconds = 5;
if(!message.content.startsWith(prefix)) return;
  if(cooldown.has(message.author.id)){
    message.delete();
  return  message.reply("Ø§Ù„ØµØ¨Ø± ÙŠØ§ Ø£Ø®ÙŠ")
  }
  if(!message.member.hasPermission("ADMINISTRATOR")){
    cooldown.add(message.author.id);
  }
setTimeout(() => {
  cooldown.delete(message.author.id)
}, cdseconds * 1000)
    });



// -ping
   client.on('message', message => {
     if (message.content === "+ping") {
      const embed = new Discord.RichEmbed()
 
  .addField('Ø³Ø±Ø¹Ø© Ø£ØªØµØ§Ù„ Ø§Ù„Ù€Ù€Ø¨ÙˆØª' , `${Date.now() - message.createdTimestamp}` + ' ms`')
                 .setFooter('Royal ForceÂ©')

  message.channel.sendEmbed(embed);
    }
});










  









client.login(process.env.BOT_TOKEN);
